;
;       {_______            {_          {______
;             {__          {_ __               {__
;             {__         {_  {__               {__
;          {__           {__   {__               {__
;      {______          {__     {__              {__
;            {__       {__       {__            {__   
;              {_________         {______________		Expansion Unit
;                     
;      RADExp - A framework for DMA interfacing with Commodore C64/C128 computers using a Raspberry Pi Zero 2 or 3A+/3B+
;      Copyright (c) 2022-26 Carsten Dachsbacher <frenetic@dachsbacher.de>
;     
;     
;     This program is free software: you can redistribute it and/or modify
;     it under the terms of the GNU General Public License as published by
;     the Free Software Foundation, either version 3 of the License, or
;     (at your option) any later version.
;    
;     This program is distributed in the hope that it will be useful,
;     but WITHOUT ANY WARRANTY; without even the implied warranty of
;     MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
;     GNU General Public License for more details.
;     
;     You should have received a copy of the GNU General Public License
;     along with this program.  If not, see <http://www.gnu.org/licenses/>.

* = $ff00
    SEI

    LDA #0
    STA $D011 
    STA $D020
    STA $D021

    LDA #$35
    STA $01     ; full access to RAM (unless in Ultimax Mode!)
    LDA #$2F
    STA $00

    LDA #$ff
    CMP $d012   ; no badlines
    BNE *-3


    LDA #$ff
    STA $d412
    STA $d40e
    STA $d40f
    LDA #$20
    STA $d412
    LDA $d41b

    CMP #2
    BEQ is8580

    CMP #3
    BEQ is6581

    LDA #0
    JMP detectSIDKick

is6581:
    LDA #$b5
    JMP detectSIDKick

is8580:
    LDA #$84

detectSIDKick:
    STA $0750


	LDA #255
	STA $d41f	; enter config mode

	LDY #0
	LDX #224

nextchar:
	STX $d41e
	LDA $d41d
	STA $0700,y

	INX
	INY
	CPY #$10
	BNE nextchar

	LDA #0
	STA $0700,y

    .fill $fffc - *, $EA

;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;

* = $FFFC
     .byte $00, $ff     ; reset routine, CPU jumps to this address after cold boot
     .byte $00
     .byte $00


